<!DOCTYPE html>
<html lang="ru">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Тест LocalStorage</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        margin: 20px;
      }
      .test-section {
        margin: 20px 0;
        padding: 15px;
        border: 1px solid #ccc;
        border-radius: 5px;
      }
      .success {
        color: green;
      }
      .error {
        color: red;
      }
      .info {
        color: blue;
      }
      button {
        margin: 5px;
        padding: 10px;
      }
      .data-display {
        background: #f5f5f5;
        padding: 10px;
        margin: 10px 0;
        border-radius: 3px;
      }
    </style>
  </head>
  <body>
    <h1>Тест функциональности LocalStorage для избранного и корзины</h1>

    <div class="test-section">
      <h2>1. Тест пользователя</h2>
      <button onclick="setTestUser()">Установить тестового пользователя</button>
      <button onclick="clearUser()">Очистить пользователя</button>
      <div id="user-status" class="data-display"></div>
    </div>

    <div class="test-section">
      <h2>2. Тест избранного</h2>
      <button onclick="addTestFavorite()">
        Добавить тестовый товар в избранное
      </button>
      <button onclick="removeTestFavorite()">
        Удалить товар из избранного
      </button>
      <button onclick="showFavorites()">Показать избранное</button>
      <div id="favorites-status" class="data-display"></div>
    </div>

    <div class="test-section">
      <h2>3. Тест корзины</h2>
      <button onclick="addTestCart()">Добавить тестовый товар в корзину</button>
      <button onclick="removeTestCart()">Удалить товар из корзины</button>
      <button onclick="showCart()">Показать корзину</button>
      <div id="cart-status" class="data-display"></div>
    </div>

    <div class="test-section">
      <h2>4. Очистка данных</h2>
      <button onclick="clearAllData()">Очистить все данные LocalStorage</button>
      <div id="clear-status" class="data-display"></div>
    </div>

    <script>
      // Тестовый пользователь
      const testUser = {
        id: 'test-user-123',
        name: 'Тестовый Пользователь',
        email: 'test@example.com',
        nickname: 'testuser',
      };

      // Тестовый товар
      const testProduct = {
        id: 'test-product-1',
        title: 'Тестовый товар',
        price: 100,
        image: './img/products/test.jpg',
      };

      function setTestUser() {
        localStorage.setItem('currentUser', JSON.stringify(testUser));
        updateUserStatus();
        log('Пользователь установлен', 'success');
      }

      function clearUser() {
        localStorage.removeItem('currentUser');
        updateUserStatus();
        log('Пользователь удален', 'info');
      }

      function updateUserStatus() {
        const user = localStorage.getItem('currentUser');
        const status = document.getElementById('user-status');
        if (user) {
          const userData = JSON.parse(user);
          status.innerHTML = `<strong>Текущий пользователь:</strong><br>
                    ID: ${userData.id}<br>
                    Имя: ${userData.name}<br>
                    Email: ${userData.email}<br>
                    Ник: ${userData.nickname}`;
        } else {
          status.innerHTML = '<strong>Пользователь не авторизован</strong>';
        }
      }

      function addTestFavorite() {
        const user = localStorage.getItem('currentUser');
        if (!user) {
          log('Сначала установите пользователя!', 'error');
          return;
        }

        const favorites = JSON.parse(localStorage.getItem('favorites') || '[]');
        const userData = JSON.parse(user);

        const favoriteItem = {
          id: Date.now().toString(),
          userId: userData.id,
          productId: testProduct.id,
          title: testProduct.title,
          price: testProduct.price,
          image: testProduct.image,
          addedAt: new Date().toISOString(),
        };

        favorites.push(favoriteItem);
        localStorage.setItem('favorites', JSON.stringify(favorites));
        log('Товар добавлен в избранное', 'success');
        showFavorites();
      }

      function removeTestFavorite() {
        const favorites = JSON.parse(localStorage.getItem('favorites') || '[]');
        const filtered = favorites.filter(
          (fav) => fav.productId !== testProduct.id
        );
        localStorage.setItem('favorites', JSON.stringify(filtered));
        log('Товар удален из избранного', 'info');
        showFavorites();
      }

      function showFavorites() {
        const favorites = JSON.parse(localStorage.getItem('favorites') || '[]');
        const status = document.getElementById('favorites-status');

        if (favorites.length === 0) {
          status.innerHTML = '<strong>Избранное пусто</strong>';
        } else {
          status.innerHTML =
            '<strong>Избранное:</strong><br>' +
            favorites
              .map(
                (fav) =>
                  `${fav.title} (${fav.price} BYN) - пользователь ${fav.userId}`
              )
              .join('<br>');
        }
      }

      function addTestCart() {
        const user = localStorage.getItem('currentUser');
        if (!user) {
          log('Сначала установите пользователя!', 'error');
          return;
        }

        const cart = JSON.parse(localStorage.getItem('cart') || '[]');
        const userData = JSON.parse(user);

        // Проверяем, есть ли уже этот товар в корзине
        const existingItem = cart.find(
          (item) =>
            item.userId === userData.id && item.productId === testProduct.id
        );

        if (existingItem) {
          existingItem.quantity += 1;
          log('Количество товара в корзине увеличено', 'success');
        } else {
          const cartItem = {
            id: Date.now().toString(),
            userId: userData.id,
            productId: testProduct.id,
            title: testProduct.title,
            price: testProduct.price,
            image: testProduct.image,
            quantity: 1,
            addedAt: new Date().toISOString(),
          };
          cart.push(cartItem);
          log('Товар добавлен в корзину', 'success');
        }

        localStorage.setItem('cart', JSON.stringify(cart));
        showCart();
      }

      function removeTestCart() {
        const cart = JSON.parse(localStorage.getItem('cart') || '[]');
        const filtered = cart.filter(
          (item) => item.productId !== testProduct.id
        );
        localStorage.setItem('cart', JSON.stringify(filtered));
        log('Товар удален из корзины', 'info');
        showCart();
      }

      function showCart() {
        const cart = JSON.parse(localStorage.getItem('cart') || '[]');
        const status = document.getElementById('cart-status');

        if (cart.length === 0) {
          status.innerHTML = '<strong>Корзина пуста</strong>';
        } else {
          let total = 0;
          status.innerHTML =
            '<strong>Корзина:</strong><br>' +
            cart
              .map((item) => {
                const itemTotal = item.price * item.quantity;
                total += itemTotal;
                return `${item.title} (${item.price} BYN × ${item.quantity} = ${itemTotal} BYN) - пользователь ${item.userId}`;
              })
              .join('<br>') +
            `<br><strong>Итого: ${total} BYN</strong>`;
        }
      }

      function clearAllData() {
        localStorage.removeItem('favorites');
        localStorage.removeItem('cart');
        localStorage.removeItem('orders');
        log('Все данные LocalStorage очищены', 'info');
        showFavorites();
        showCart();
      }

      function log(message, type = 'info') {
        const status = document.getElementById('clear-status');
        const timestamp = new Date().toLocaleTimeString();
        status.innerHTML += `<div class="${type}">[${timestamp}] ${message}</div>`;
      }

      // Инициализация
      window.onload = function () {
        updateUserStatus();
        showFavorites();
        showCart();
      };
    </script>
  </body>
</html>
