var i18ObjLocal = {
  ru: {
    // –ù–∞–≤–∏–≥–∞—Ü–∏—è
    'nav-catalog': '–ö–∞—Ç–∞–ª–æ–≥',
    'nav-favorites': '–ò–∑–±—Ä–∞–Ω–Ω–æ–µ',
    'nav-cart': '–ö–æ—Ä–∑–∏–Ω–∞',
    'nav-orders': '–ó–∞–∫–∞–∑—ã',
    'nav-feedback': '–û—Ç–∑—ã–≤—ã',
    'nav-admin': '–ê–¥–º–∏–Ω',
    'nav-register': '–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è',
    'nav-login': '–í—Ö–æ–¥',
    'nav-promo': '–ü—Ä–æ–º–æ',
    'nav-about': '–û –Ω–∞—Å',
    'nav-gallery': '–ì–∞–ª–µ—Ä–µ—è',
    'nav-contacts': '–ö–æ–Ω—Ç–∞–∫—Ç—ã',
    'nav-lang': '–Ø–∑—ã–∫',

    // –ö–∞—Ç–∞–ª–æ–≥
    'catalog-title': '–ö–∞—Ç–∞–ª–æ–≥ —Ç–æ–≤–∞—Ä–æ–≤',
    'sort-default': '–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞',
    'sort-price': '–ü–æ —Ü–µ–Ω–µ',
    'sort-title': '–ü–æ –Ω–∞–∑–≤–∞–Ω–∏—é',
    'sort-rating': '–ü–æ —Ä–µ–π—Ç–∏–Ω–≥—É',
    'about-title': '–û –Ω–∞—Å',
    'gallery-title': '–ú–µ–¥–∏–∞–≥–∞–ª–µ—Ä–µ—è',
    'map-title': '–ú—ã –Ω–∞ –∫–∞—Ä—Ç–µ',
    'map-modal-btn': '–û—Ç–∫—Ä—ã—Ç—å –∫–∞—Ä—Ç—É –≤ –æ–∫–Ω–µ',
    'theme-toggle': '–°–º–µ–Ω–∏—Ç—å —Ç–µ–º—É',
    language: '–Ø–∑—ã–∫',
    'gal-random': '–°–ª—É—á–∞–π–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ',
    'gal-volume': '–ì—Ä–æ–º–∫–æ—Å—Ç—å',
    'gal-video-btn': '–í–∏–¥–µ–æ',
    'search-placeholder': '–ü–æ–∏—Å–∫ —Ç–æ–≤–∞—Ä–æ–≤...',
    'no-items': '–ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ',
    'load-error': '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–∞—Ç–∞–ª–æ–≥–∞',
    'details-btn': '–ü–æ–¥—Ä–æ–±–Ω–µ–µ',
    'cart-btn': 'üõí –í –∫–æ—Ä–∑–∏–Ω—É',
    'fav-btn': '–í –∏–∑–±—Ä–∞–Ω–Ω–æ–µ',
    'auth-required': '–ù—É–∂–Ω–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è',
    'cart-added': '–î–æ–±–∞–≤–ª–µ–Ω–æ –≤ –∫–æ—Ä–∑–∏–Ω—É',
    'fav-added': '–î–æ–±–∞–≤–ª–µ–Ω–æ –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ',
    'fav-exists': '–£–∂–µ –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–º',
    'price-label': '–¶–µ–Ω–∞',

    // –ö–∞—Ç–µ–≥–æ—Ä–∏–∏
    'category-all': '–í—Å–µ',
    'category-electronics': '–≠–ª–µ–∫—Ç—Ä–æ–Ω–∏–∫–∞',
    'category-books': '–ö–Ω–∏–≥–∏',
    'category-clothing': '–û–¥–µ–∂–¥–∞',
    'category-sports': '–°–ø–æ—Ä—Ç',

    // –ü—Ä–æ—Ñ–∏–ª—å
    logout: '–í—ã–π—Ç–∏',
    'profile-title': '–ü—Ä–æ—Ñ–∏–ª—å',
    'profile-subtitle': '–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏ –∞–∫–∫–∞—É–Ω—Ç–∞',
    name: '–ò–º—è',
    email: 'Email',
    nickname: '–ù–∏–∫',
    'name-placeholder': '–í–≤–µ–¥–∏—Ç–µ –≤–∞—à–µ –∏–º—è',
    'email-placeholder': '–í–≤–µ–¥–∏—Ç–µ –≤–∞—à email',
    'nickname-placeholder': '–í–≤–µ–¥–∏—Ç–µ –≤–∞—à –Ω–∏–∫',
    save: '–°–æ—Ö—Ä–∞–Ω–∏—Ç—å',
    saving: '–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ...',
    cancel: '–û—Ç–º–µ–Ω–∞',
    reset: '–°–±—Ä–æ—Å –Ω–∞—Å—Ç—Ä–æ–µ–∫',
    'reset-confirm-title': '–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —Å–±—Ä–æ—Å–∞',
    'reset-confirm-message':
      '–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —Å–±—Ä–æ—Å–∏—Ç—å –≤—Å–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏? –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å.',
    'reset-confirm': '–î–∞, —Å–±—Ä–æ—Å–∏—Ç—å',
    resetting: '–°–±—Ä–æ—Å –Ω–∞—Å—Ç—Ä–æ–µ–∫...',
    'profile-updated': '–ü—Ä–æ—Ñ–∏–ª—å —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª—ë–Ω!',

    // –õ–æ–≥–∏–Ω (–ù–û–í–û–ï)
    'login-title': '–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è',
    'login-heading': '–í—Ö–æ–¥ –≤ —Å–∏—Å—Ç–µ–º—É',
    'login-email': 'Email*',
    'login-email-placeholder': 'example@mail.com',
    'login-password': '–ü–∞—Ä–æ–ª—å*',
    'login-password-placeholder': '–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å',
    'login-btn': '–í–æ–π—Ç–∏',
    'login-no-account': '–ù–µ—Ç –∞–∫–∫–∞—É–Ω—Ç–∞?',
    'login-register-link': '–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ—Å—å',
    'login-error-server': '–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, –∑–∞–ø—É—â–µ–Ω –ª–∏ json-server',
    'login-error-not-found': '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å —Ç–∞–∫–∏–º email –Ω–µ –Ω–∞–π–¥–µ–Ω!',
    'login-error-password': '–ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å!',
    'login-error-connection':
      '–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ —Å–µ—Ä–≤–µ—Ä—É. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å.',
    'login-success': '–£—Å–ø–µ—à–Ω—ã–π –≤—Ö–æ–¥!',
    'login-already-logged': '–í—ã —É–∂–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω—ã. –ü–µ—Ä–µ–π—Ç–∏ –≤ –∫–∞—Ç–∞–ª–æ–≥?',
    loading: '–ó–∞–≥—Ä—É–∑–∫–∞‚Ä¶',
  },
  en: {
    // Navigation
    'nav-catalog': 'Catalog',
    'nav-favorites': 'Favorites',
    'nav-cart': 'Cart',
    'nav-orders': 'Orders',
    'nav-feedback': 'Feedback',
    'nav-admin': 'Admin',
    'nav-register': 'Register',
    'nav-login': 'Login',
    'nav-promo': 'Promo',
    'nav-about': 'About Us',
    'nav-gallery': 'Gallery',
    'nav-contacts': 'Contacts',
    'nav-lang': 'Language',

    // Catalog
    'catalog-title': 'Product Catalog',
    'sort-default': 'Sort by',
    'sort-price': 'By Price',
    'sort-title': 'By Name',
    'sort-rating': 'By Rating',
    'about-title': 'About Us',
    'gallery-title': 'Media Gallery',
    'map-title': 'Our Location',
    'map-modal-btn': 'Open Map in Window',
    'theme-toggle': 'Toggle Theme',
    language: 'Language',
    'gal-random': 'Random Image',
    'gal-volume': 'Volume',
    'gal-video-btn': 'Video',
    'search-placeholder': 'Search products...',
    'no-items': 'Nothing found',
    'load-error': 'Catalog loading error',
    'details-btn': 'Details',
    'cart-btn': 'üõí Add to Cart',
    'fav-btn': 'Add to Favorites',
    'auth-required': 'Authorization required',
    'cart-added': 'Added to cart',
    'fav-added': 'Added to favorites',
    'fav-exists': 'Already in favorites',
    'price-label': 'Price',

    // Categories
    'category-all': 'All',
    'category-electronics': 'Electronics',
    'category-books': 'Books',
    'category-clothing': 'Clothing',
    'category-sports': 'Sports',

    // Profile
    logout: 'Logout',
    'profile-title': 'Profile',
    'profile-subtitle': 'Manage your account settings',
    name: 'Name',
    email: 'Email',
    nickname: 'Nickname',
    'name-placeholder': 'Enter your name',
    'email-placeholder': 'Enter your email',
    'nickname-placeholder': 'Enter your nickname',
    save: 'Save',
    saving: 'Saving...',
    cancel: 'Cancel',
    reset: 'Reset Settings',
    'reset-confirm-title': 'Confirm Reset',
    'reset-confirm-message':
      'Are you sure you want to reset all settings? This action cannot be undone.',
    'reset-confirm': 'Yes, reset',
    resetting: 'Resetting settings...',
    'profile-updated': 'Profile successfully updated!',

    // Login (NEW)
    'login-title': 'Login',
    'login-heading': 'Sign In',
    'login-email': 'Email*',
    'login-email-placeholder': 'example@mail.com',
    'login-password': 'Password*',
    'login-password-placeholder': 'Enter password',
    'login-btn': 'Sign In',
    'login-no-account': "Don't have an account?",
    'login-register-link': 'Register',
    'login-error-server': 'Server error. Check if json-server is running',
    'login-error-not-found': 'User with this email not found!',
    'login-error-password': 'Invalid password!',
    'login-error-connection': 'Server connection error. Check console.',
    'login-success': 'Login successful!',
    'login-already-logged': 'You are already logged in. Go to catalog?',
    loading: 'Loading‚Ä¶',
  },
};

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –≥–ª–æ–±–∞–ª—å–Ω—ã—Ö –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö
window.lang = localStorage.getItem('lang') || 'ru';
window.theme = localStorage.getItem('theme') || 'light';
window.i18Obj = i18ObjLocal;

// –§—É–Ω–∫—Ü–∏—è –ø–µ—Ä–µ–≤–æ–¥–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
window.getTranslate = function (newLang) {
  var currentLang = newLang || window.lang;

  // –ü–µ—Ä–µ–≤–æ–¥–∏–º —ç–ª–µ–º–µ–Ω—Ç—ã —Å data-i18n
  document.querySelectorAll('[data-i18n]').forEach(function (el) {
    var key = el.dataset.i18n;
    if (window.i18Obj[currentLang] && window.i18Obj[currentLang][key]) {
      el.textContent = window.i18Obj[currentLang][key];
    }
  });

  // –ü–µ—Ä–µ–≤–æ–¥–∏–º placeholder'—ã
  document.querySelectorAll('[data-i18n-placeholder]').forEach(function (el) {
    var key = el.dataset.i18nPlaceholder;
    if (window.i18Obj[currentLang] && window.i18Obj[currentLang][key]) {
      el.placeholder = window.i18Obj[currentLang][key];
    }
  });

  // –ü–µ—Ä–µ–≤–æ–¥–∏–º title —Å—Ç—Ä–∞–Ω–∏—Ü—ã
  var titleEl = document.querySelector('title[data-i18n]');
  if (titleEl) {
    var key = titleEl.dataset.i18n;
    if (window.i18Obj[currentLang] && window.i18Obj[currentLang][key]) {
      document.title = window.i18Obj[currentLang][key];
    }
  }

  // –ü–µ—Ä–µ–≤–æ–¥–∏–º —ç–ª–µ–º–µ–Ω—Ç—ã —Å data-i18n-key (–¥–ª—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏—Ö –∫–Ω–æ–ø–æ–∫)
  document.querySelectorAll('[data-i18n-key]').forEach(function (el) {
    var key = el.dataset.i18nKey;
    if (window.i18Obj[currentLang] && window.i18Obj[currentLang][key]) {
      el.textContent = window.i18Obj[currentLang][key];
    }
  });

  // –û–±–Ω–æ–≤–ª—è–µ–º –≥–ª–æ–±–∞–ª—å–Ω—É—é –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é
  window.lang = currentLang;

  // –í—ã–∑—ã–≤–∞–µ–º –ø–µ—Ä–µ—Ä–µ–Ω–¥–µ—Ä –∫–∞—Ç–∞–ª–æ–≥–∞, –µ—Å–ª–∏ —Ñ—É–Ω–∫—Ü–∏—è —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
  if (typeof window.reRenderCatalog === 'function') {
    console.log('Calling reRenderCatalog from translate.js');
    window.reRenderCatalog();
  }
};

// –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –≤ localStorage
window.setLocalStorage = function () {
  localStorage.setItem('lang', window.lang);
  localStorage.setItem('theme', window.theme);
};

// –ó–∞–≥—Ä—É–∑–∫–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –∏–∑ localStorage
window.getLocalStorage = function () {
  var savedLang = localStorage.getItem('lang');
  if (savedLang) {
    window.lang = savedLang;
    window.getTranslate(window.lang);
    window.updateLangDisplay(window.lang);
  }
  var savedTheme = localStorage.getItem('theme');
  if (savedTheme) {
    window.theme = savedTheme;
    var isDark = window.theme === 'dark';
    document.body.classList.toggle('dark-theme', isDark);
    window.updateThemeSymbol(isDark ? 'üåô' : '‚òÄÔ∏è');
    window.toggleThemeImages(isDark);
  }
};

// –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø–µ—Ä–µ–¥ –∑–∞–∫—Ä—ã—Ç–∏–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—ã
window.addEventListener('beforeunload', window.setLocalStorage);

// –ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
window.addEventListener('load', window.getLocalStorage);

// === –¢–ï–ú–ê ===

// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–∏–º–≤–æ–ª–∞ —Ç–µ–º—ã
window.updateThemeSymbol = function (symbol) {
  var btn = document.getElementById('theme-switch');
  var mobileBtn = document.getElementById('mobile-theme-btn');
  if (btn) btn.textContent = symbol;
  if (mobileBtn) mobileBtn.textContent = symbol;
};

// –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –¥–ª—è —Ç–µ–º—ã
window.toggleThemeImages = function (isDark) {
  document.querySelectorAll('[data-theme-src-dark]').forEach(function (img) {
    var darkSrc = img.dataset.themeSrcDark;
    if (darkSrc) {
      if (!img.dataset.themeSrcLight) img.dataset.themeSrcLight = img.src;
      img.src = isDark ? darkSrc : img.dataset.themeSrcLight;
    }
  });
};

// –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ç–µ–º—ã
window.toggleTheme = function () {
  var isDark = !document.body.classList.contains('dark-theme');
  document.body.classList.toggle('dark-theme');
  window.theme = isDark ? 'dark' : 'light';
  window.updateThemeSymbol(isDark ? 'üåô' : '‚òÄÔ∏è');
  window.toggleThemeImages(isDark);
  window.setLocalStorage();
};

// –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–Ω–æ–ø–æ–∫ —Ç–µ–º—ã
var themeBtn = document.getElementById('theme-switch');
var mobileThemeBtn = document.getElementById('mobile-theme-btn');
if (themeBtn) themeBtn.addEventListener('click', window.toggleTheme);
if (mobileThemeBtn)
  mobileThemeBtn.addEventListener('click', window.toggleTheme);

// === –Ø–ó–´–ö ===

// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∞–∫—Ç–∏–≤–Ω–æ–≥–æ —è–∑—ã–∫–∞
window.updateLangDisplay = function (currentLang) {
  document
    .querySelectorAll('.lang-switcher button[data-lang]')
    .forEach(function (btn) {
      btn.classList.toggle('active', btn.dataset.lang === currentLang);
    });
};

// –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —è–∑—ã–∫–∞
window.handleLangSwitch = function (e) {
  var btn = e.target.closest('button[data-lang]');
  if (!btn || btn.dataset.lang === window.lang) return;

  var newLang = btn.dataset.lang;
  console.log('Language switch clicked:', newLang);

  window.getTranslate(newLang);
  window.updateLangDisplay(newLang);
  window.setLocalStorage();
};

// –ì–ª–æ–±–∞–ª—å–Ω—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–æ–≤ –¥–ª—è —è–∑—ã–∫–∞
document.addEventListener('click', window.handleLangSwitch);

// === –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø ===

document.addEventListener('DOMContentLoaded', function () {
  console.log('DOMContentLoaded: initializing...');
  window.getLocalStorage();
  window.getTranslate(window.lang);
  console.log('Initial language:', window.lang);
});
